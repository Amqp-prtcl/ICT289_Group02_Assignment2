#include "table.h"

#define table(lx, lz, y) {\
    {1, 0, 0},\
    {lx/2.0, y, lz/2.0},\
    {-lx/2.0, y, lz/2.0},\
    {-lx/2.0, y, -lz/2.0},\
},

#define x_wall(l, h, x, z) {\
    {1, 0, 0},\
    {x, 0, -(l)/2.0 + z},\
    {x, 0, (l)/2.0 + z},\
    {x, h, (l)/2.0 + z},\
}

#define z_wall(l, h, z, x) {\
    {1, 0, 0},\
    {-(l)/2.0 + x, 0, z},\
    {(l)/2.0 + x, 0, z},\
    {(l)/2.0 + x, h, z},\
}

static struct wall walls[] = {
    // table (full)
    {
        {.3, .3, .3},
        {2.9/2, 0, 1.63/2},
        {-2.9/2, 0, 1.63/2},
        {-2.9/2, 0, -1.63/2},
        0, 0,
    },
    {
        {.3, 1, .3},
        {2.540/2, 0, 1.270/2},
        {-2.540/2, 0, 1.270/2},
        {-2.540/2, 0, -1.270/2},
        0, 0
    },
    z_wall(2.540/2 - 0.12, 0.05715, 1.27/2.0, 2.54/4),
    z_wall(2.540/2 - 0.12, 0.05715, 1.27/2.0, -2.54/4),
    z_wall(2.540/2 - 0.12, 0.05715, -1.27/2.0, 2.54/4),
    z_wall(2.540/2 - 0.12, 0.05715, -1.27/2.0, -2.54/4),
    x_wall(1.27 - 0.12, 0.05715, 2.54/2.0, 0),
    x_wall(1.27 - 0.12, 0.05715, -2.54/2.0, 0),

    {
        {0, 0, 1},
        {0.06, 0.0    , 1.27/2.0},
        {0.00, 0.0    , 1.63/2.0},
        {0.00, 0.05715, 1.63/2.0},
    },
    {
        {0, 0, 1},
        {-0.06, 0.0    , 1.27/2.0},
        { 0.00, 0.0    , 1.63/2.0},
        { 0.00, 0.05715, 1.63/2.0},
    },
    {
        {0, 1, 1},
        { 0.12, 0.0    , 1.27/2.0},
        {-0.12, 0.0    , 1.63/2.0},
        {-0.12, 0.05715, 1.63/2.0},
    },
    {
        {0, 1, 1},
        {-0.12, 0.0    , 1.27/2.0},
        { 0.12, 0.0    , 1.63/2.0},
        { 0.12, 0.05715, 1.63/2.0},
    },

    {
        {0, 0, 1},
        {0.06, 0.0    , -1.27/2.0},
        {0.00, 0.0    , -1.63/2.0},
        {0.00, 0.05715, -1.63/2.0},
    },
    {
        {0, 0, 1},
        {-0.06, 0.0    , -1.27/2.0},
        { 0.00, 0.0    , -1.63/2.0},
        { 0.00, 0.05715, -1.63/2.0},
    },
    {
        {0, 1, 1},
        { 0.12, 0.0    , -1.27/2.0},
        {-0.12, 0.0    , -1.63/2.0},
        {-0.12, 0.05715, -1.63/2.0},
    },
    {
        {0, 1, 1},
        {-0.12, 0.0    , -1.27/2.0},
        { 0.12, 0.0    , -1.63/2.0},
        { 0.12, 0.05715, -1.63/2.0},
    },

    {
        {0, 0, 1},
        { 2.54/2.0 - 0.06, 0.0    , 1.27/2.0},
        { 2.90/2.0 - 0.06, 0.0    , 1.63/2.0},
        { 2.90/2.0 - 0.06, 0.05715, 1.63/2.0},
    },
    {
        {0, 0, 1},
        { 2.54/2.0, 0.0    , 1.27/2.0 - 0.06},
        { 2.90/2.0, 0.0    , 1.63/2.0 - 0.06},
        { 2.90/2.0, 0.05715, 1.63/2.0 - 0.06},
    },
    {
        {1, 1, 1},
        { (2.54 + 2.90)/4.0, 0.0    , 1.27/2.0},
        { 2.54/2.0         , 0.0    , (1.27+1.63)/4.0},
        { 2.54/2.0         , 0.05715, (1.27+1.63)/4.0},
    },
    {
        {0, 1, 1},
        { 2.54/2.0 + 0.06, 0.0    , 1.27/2.0 - 0.06},
        { 2.54/2.0 + 0.06, 0.0    , (1.27+1.63)/4.0},
        { 2.54/2.0 + 0.06, 0.05715, (1.27+1.63)/4.0},
    },
    {
        {0, 1, 1},
        { 2.54/2.0 - 0.06, 0.0    , 1.27/2.0 + 0.06},
        { (2.54+2.9)/4.0 , 0.0    , 1.27/2.0 + 0.06},
        { (2.54+2.9)/4.0 , 0.05715, 1.27/2.0 + 0.06},
    },
};

void init_default_table(struct table *table) {
    object_trans_reset(&table->trans);
    table->walls = walls;
    table->walls_num = sizeof(walls) / sizeof(struct wall);
    for (size_t i = 0; i < table->walls_num; i++)
        CHECK_WALL(walls + i);
}

void draw_table(const struct table *table) {
    glPushMatrix();
    object_trans_apply(&table->trans);
    for (size_t i = 0; i < table->walls_num; i++)
        draw_wall(table->walls + i);
    glPopMatrix();
}
